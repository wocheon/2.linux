# Model/배치 컨테이너 분리 구성

## 개요
* 기존 모델 및 데이터 로드를 한번에 진행하던 컨테이너를 역할별로 분리하여 구성 
    * 각 모델을 메모리에 올려두고 FastAPI를 통해 엔드포인트를 제공하는 형태의 컨테이너를 구성 
    * DB/ElasticSearch 데이터 로드하여 특정 모델의 FASTAPI 엔드포인트로 POST 요청을 보내 결과 도출 하여 Insert

* 분리 사유
    * 기존 방식으로 구성시 이미지 리빌드 및 재배포 시 많은 소요시간 필요
    * 모델 업데이트 및 배치 쿼리 변경이 용이해짐

## 기존 방식과 비교

* 기존 배치 동작 방식 
    * 모델별로 하나의 컨테이너로 실행
    * DB/ElasticSearch 데이터 로드 및 모델을 직접 로드하여 배치를 동작 후, DB에 데이터 Insert

* 변경 후
    * 모델 엔드포인트용 컨테이너, request를 통해 배치를 실행하는 컨테이너로 구분
    * 여러 모델을 넣어두고 endpoint 경로 구분을 통해 각기 다른 모델에 요청을 보낼수 있음

    * model_fastapi 
        * Koelectra, Kobert 모델을 메모리에 로드해두고 FastAPI를 통해 엔드포인트를 제공하는 컨테이너
        * DB 및 Elasticsearch에 연결필요 없음
    * request_batch
        * DB/ElasticSearch 데이터 로드 및 모델을 직접 로드하여 배치를 동작 후, DB에 데이터 Insert
        * 모델 로드를 위한 패키지 설치가 없으므로 가볍고 빠르게 실행/재배포 가능