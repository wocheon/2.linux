<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>KoElectra Articles Table - sb-admin-2</title>

    <!-- CSS: Bootstrap, sb-admin-2, DataTables Bootstrap4 -->
    <link href="static/css/bootstrap.min.css" rel="stylesheet" />
    <link href="static/css/sb-admin-2.min.css" rel="stylesheet" />
    <link href="static/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <style>
      thead input, thead select {
        width: 100%;
        box-sizing: border-box;
        height: 32px;
        padding: 4px 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
    </style>
</head>
<body id="page-top">
{% set active_tab = 'koelectra' %}
{% include 'header.html' %}

<div class="container-fluid mt-4">

    <h1 class="h3 mb-3 text-gray-800">KoElectra Articles Table</h1>

    <button id="toggle-filter-btn" class="btn btn-secondary mb-3">í•„í„° í† ê¸€</button>

    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead class="thead-dark">
                        <tr>
                            <th>id</th>
                            <th>keyword_id</th>
                            <th>keyword</th>
                            <th>title</th>
                            <th>content</th>
                            <th>url</th>
                            <th>sentiment</th>
                            <th>score</th>
                            <th>published_at</th>
                            <th>collected_at</th>
                        </tr>
                        <!-- í•„í„° í–‰ -->
                        <tr id="filter-row" style="display:none;">
                            <th><input type="text" placeholder="ê²€ìƒ‰ id" /></th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ keyword_id" /></th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ keyword" /></th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ title" /></th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ content" /></th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ url" /></th>
                            <!-- sentiment ë“œë¡­ë‹¤ìš´ -->
                            <th>
                                <select>
                                    <option value="">ì „ì²´</option>
				    {% for s in sentiment_list %}
				    <option value="{{ s }}">{{ s|capitalize }}</option>
			            {% endfor %}
                                </select>
                            </th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ score" /></th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ published_at" /></th>
                            <th><input type="text" placeholder="ê²€ìƒ‰ collected_at" /></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for row in data %}
                        <tr>
                            {% for value in row %}
                                {% set idx = loop.index0 %}
                                {% if idx == 5 %}
                                    <td><a href="{{ value }}" target="_blank" rel="noopener noreferrer">ê¸°ì‚¬ë§í¬</a></td>
                                {% elif idx == 6 %}
                                    <td>
                                        {% set emoji_map = {
                                            'angry': 'ğŸ˜ ',
                                            'happy': 'ğŸ˜Š',
                                            'anxious': 'ğŸ˜°',
                                            'embarrassed': 'ğŸ˜³',
                                            'sad': 'ğŸ˜¢',
                                            'heartache': 'ğŸ’”'
                                        } %}
                                        {{ emoji_map.get(value|lower, 'â“') }} {{ value }}
                                    </td>
                                {% elif idx == 7 %}
                                    <td style="min-width: 120px;">
                                        <div>{{ "%.3f"|format(value) }}</div>
                                        <div class="progress">
                                            <div class="progress-bar" role="progressbar"
                                                 style="width: {{ (value * 100)|round(2) }}%;"
                                                 aria-valuenow="{{ (value * 100)|round(2) }}"
                                                 aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </td>
                                {% else %}
                                    <td>{{ value }}</td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<!-- JS: jQuery, Bootstrap, DataTables, sb-admin-2 -->
<script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap4.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/sb-admin-2.min.js') }}"></script>

<script>
$(document).ready(function() {
    var table = $('#dataTable').DataTable({
        orderCellsTop: true,
        fixedHeader: true,
        language: {
            search: "ê²€ìƒ‰:",
            lengthMenu: "í˜ì´ì§€ë‹¹ _MENU_ ê°œì”© ë³´ê¸°",
            info: "_TOTAL_ê±´ ì¤‘ _START_~_END_ë²ˆì§¸",
            paginate: {
                next: "ë‹¤ìŒ",
                previous: "ì´ì „"
            }
        },
        ordering: true,
        paging: true,
        info: true,
    });

    // í…ìŠ¤íŠ¸ í•„í„° ì´ë²¤íŠ¸
    $('#dataTable thead tr:eq(1) th').each(function(i) {
        var input = $(this).find('input');
        if(input.length) {
            input.on('keyup change clear', function() {
                if(table.column(i).search() !== this.value) {
                    table.column(i).search(this.value).draw();
                }
            });
        }
    });

    // ë“œë¡­ë‹¤ìš´ í•„í„° ì´ë²¤íŠ¸ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì—†ì´ ë‹¨ìˆœ ë¬¸ìì—´ í¬í•¨ ê²€ìƒ‰)
    $('#dataTable thead tr:eq(1) th').each(function(i) {
        var select = $(this).find('select');
        if(select.length) {
            select.on('change', function() {
                var val = $(this).val();
                table.column(i).search(val || '', false, false).draw();
            });
        }
    });

    // í•„í„° í† ê¸€ ë²„íŠ¼
    $('#toggle-filter-btn').click(function() {
        var filterRow = $('#filter-row');
        filterRow.toggle();
        table.columns.adjust().draw();
    });
});
</script>

</body>
</html>

