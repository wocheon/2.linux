<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>KoElectra Articles Table - sb-admin-2</title>

    <!-- CSS: Bootstrap, sb-admin-2, DataTables Bootstrap4 -->
    <link href="static/css/bootstrap.min.css" rel="stylesheet" />
    <link href="static/css/sb-admin-2.min.css" rel="stylesheet" />
    <link href="static/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <style>
      thead input, thead select {
        width: 100%;
        box-sizing: border-box;
        height: 32px;
        padding: 4px 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
    </style>
</head>
<body id="page-top">
{% set active_tab = 'koelectra' %}
{% include 'header.html' %}

<div class="container-fluid mt-4">

    <h1 class="h3 mb-3 text-gray-800">KoElectra Articles Table</h1>

    <button id="toggle-filter-btn" class="btn btn-secondary mb-3">필터 토글</button>

    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                    <thead class="thead-dark">
                        <tr>
                            <th>id</th>
                            <th>keyword_id</th>
                            <th>keyword</th>
                            <th>title</th>
                            <th>content</th>
                            <th>url</th>
                            <th>sentiment</th>
                            <th>score</th>
                            <th>published_at</th>
                            <th>collected_at</th>
                        </tr>
                        <!-- 필터 행 -->
                        <tr id="filter-row" style="display:none;">
                            <th><input type="text" placeholder="검색 id" /></th>
                            <th><input type="text" placeholder="검색 keyword_id" /></th>
                            <th><input type="text" placeholder="검색 keyword" /></th>
                            <th><input type="text" placeholder="검색 title" /></th>
                            <th><input type="text" placeholder="검색 content" /></th>
                            <th><input type="text" placeholder="검색 url" /></th>
                            <!-- sentiment 드롭다운 -->
                            <th>
                                <select>
                                    <option value="">전체</option>
				    {% for s in sentiment_list %}
				    <option value="{{ s }}">{{ s|capitalize }}</option>
			            {% endfor %}
                                </select>
                            </th>
                            <th><input type="text" placeholder="검색 score" /></th>
                            <th><input type="text" placeholder="검색 published_at" /></th>
                            <th><input type="text" placeholder="검색 collected_at" /></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for row in data %}
                        <tr>
                            {% for value in row %}
                                {% set idx = loop.index0 %}
                                {% if idx == 5 %}
                                    <td><a href="{{ value }}" target="_blank" rel="noopener noreferrer">기사링크</a></td>
                                {% elif idx == 6 %}
                                    <td>
                                        {% set emoji_map = {
                                            'angry': '😠',
                                            'happy': '😊',
                                            'anxious': '😰',
                                            'embarrassed': '😳',
                                            'sad': '😢',
                                            'heartache': '💔'
                                        } %}
                                        {{ emoji_map.get(value|lower, '❓') }} {{ value }}
                                    </td>
                                {% elif idx == 7 %}
                                    <td style="min-width: 120px;">
                                        <div>{{ "%.3f"|format(value) }}</div>
                                        <div class="progress">
                                            <div class="progress-bar" role="progressbar"
                                                 style="width: {{ (value * 100)|round(2) }}%;"
                                                 aria-valuenow="{{ (value * 100)|round(2) }}"
                                                 aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </td>
                                {% else %}
                                    <td>{{ value }}</td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<!-- JS: jQuery, Bootstrap, DataTables, sb-admin-2 -->
<script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap4.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/sb-admin-2.min.js') }}"></script>

<script>
$(document).ready(function() {
    var table = $('#dataTable').DataTable({
        orderCellsTop: true,
        fixedHeader: true,
        language: {
            search: "검색:",
            lengthMenu: "페이지당 _MENU_ 개씩 보기",
            info: "_TOTAL_건 중 _START_~_END_번째",
            paginate: {
                next: "다음",
                previous: "이전"
            }
        },
        ordering: true,
        paging: true,
        info: true,
    });

    // 텍스트 필터 이벤트
    $('#dataTable thead tr:eq(1) th').each(function(i) {
        var input = $(this).find('input');
        if(input.length) {
            input.on('keyup change clear', function() {
                if(table.column(i).search() !== this.value) {
                    table.column(i).search(this.value).draw();
                }
            });
        }
    });

    // 드롭다운 필터 이벤트 (대소문자 구분없이 단순 문자열 포함 검색)
    $('#dataTable thead tr:eq(1) th').each(function(i) {
        var select = $(this).find('select');
        if(select.length) {
            select.on('change', function() {
                var val = $(this).val();
                table.column(i).search(val || '', false, false).draw();
            });
        }
    });

    // 필터 토글 버튼
    $('#toggle-filter-btn').click(function() {
        var filterRow = $('#filter-row');
        filterRow.toggle();
        table.columns.adjust().draw();
    });
});
</script>

</body>
</html>

