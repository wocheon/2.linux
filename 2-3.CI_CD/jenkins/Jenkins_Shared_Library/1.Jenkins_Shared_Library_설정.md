# Jenkins Shared Library ì„¤ì • 


## Jenkins Shared Library?
- ì—¬ëŸ¬ íŒŒì´í”„ë¼ì¸ì—ì„œ ê³µí†µ ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥
- í•˜ë‚˜ì˜ Git ì €ì¥ì†Œì— ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” Groovy ìŠ¤í¬ë¦½íŠ¸, í´ë˜ìŠ¤, í…œí”Œë¦¿ ë“±ì„ ì €ì¥
    - ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ @Library('shared-lib')í˜•íƒœë¡œ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš© ê°€ëŠ¥

- Jenkins Shared Libraryì˜ ì¥ë‹¨ì 
    - ì¥ì  
        - ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ ë™ì¼í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì¤‘ì•™í™”ëœ ê´€ë¦¬ ê°€ëŠ¥í•´ì§
        - íƒœê·¸/ë¸Œëœì¹˜ë¥¼ í†µí•´ íŠ¹ì • ë²„ì „ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©ê°€ëŠ¥
        - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í¬í•¨ ê°€ëŠ¥ (src/ êµ¬ì¡°)
        - DevOps Best Practiceì— ë¶€í•©

    - ë‹¨ì 
        - ì²˜ìŒ ì„¤ì • ì‹œ Jenkinsì— ë“±ë¡í•˜ëŠ” ìˆ˜ê³ ê°€ ìˆìŒ
        - Jenkins Master ë…¸ë“œ ë˜ëŠ” Folder-levelì— ì„¤ì • í•„ìš”

### Jenkins Shared Library ê¸°ë³¸ êµ¬ì¡°

```
shared-library/
â”œâ”€â”€ vars/
â”‚   â””â”€â”€ buildPipeline.groovy      # í•¨ìˆ˜í˜• API 
â”œâ”€â”€ src/
â”‚   â””â”€â”€ org/company/build/Deploy.groovy  # í´ë˜ìŠ¤ ê¸°ë°˜ ë¡œì§
â””â”€â”€ resources/
    â””â”€â”€ org/company/template.yml
```

- vars/ 
    - Jenkinsfileì—ì„œ í•¨ìˆ˜ì²˜ëŸ¼ ë°”ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸. ë‚´ë¶€ì— call() ë˜ëŠ” ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
        - EX) buildApp()

- src/ 
    - Groovy í´ë˜ìŠ¤ë¥¼ ë„£ëŠ” ê³³. ë³µì¡í•œ ë¡œì§ì„ ë¶„ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©. íŒ¨í‚¤ì§€ êµ¬ì¡° í•„ìˆ˜ 
        - EX) com.mycompany.utils.SomeHelper

- resources/
    - í…œí”Œë¦¿ íŒŒì¼, YAML, JSON ë“± pipeline ì‹¤í–‰ ì‹œ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤
        - EX) env.env, config.json


##  Jenkins Shared Library ìš© Git ì €ì¥ì†Œ ìƒì„± 
- gitlab ì €ì¥ì†Œ ìƒì„± 
    - ì €ì¥ì†Œ ëª… : jenkins_shared_library
    
- ì €ì¥ì†Œ ìƒì„± í›„, ê¸°ë³¸ êµ¬ì¡°ì™€ ê°™ì´ ë””ë ‰í† ë¦¬ ìƒì„± ì§„í–‰ 

- Jenkins ì—°ë™ì´ í•„ìš”í•˜ë¯€ë¡œ Access Tokenì„ í™•ì¸í•˜ê³  Credentialsë¡œ ë“±ë¡
    - GitHub : Personal Access Token
    - GitLab : Project Access Token OR UserID/PW

## Jenkins ë‚´ Jenkins Shared Library ì„¤ì • 

- ì„¤ì • ë°©ë²• 
    - Jenkins ê´€ë¦¬ -> System -> Global Trusted Pipeline Librariesì— ì •ë³´ ì…ë ¥
        - Name : Library ëª… (ì¶”í›„ Pipelineì—ì„œ ë¡œë“œì‹œ ì‚¬ìš©ë¨)
        - Default Version : ê¸°ë³¸ ë¸Œëœì¹˜ ëª… 
        - Retrieval method : Modern SCM
        - Source Code Mgmt : git
        - Project repository : ì €ì¥ì†Œ URL (GitHub/GitLab ì£¼ì†Œ)
        - Credentials : ì €ì¥ì†Œ ì ‘ê·¼ìš© Credentials

### Global Trusted/Untrusted Libraries ?
- System ë‚´ì—ëŠ” `Global Trusted Libraries`ì™€  `Global Untrusted Libraries` ì„¹ì…˜ì´ êµ¬ë¶„ë˜ì–´ìˆëŠ”ë°, ë‹¤ìŒ ë‚´ìš©ì„ ì°¸ê³ í•˜ì—¬ ì„ íƒí•˜ì—¬ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë“±ë¡ í•˜ì—¬ ì‚¬ìš©í• ê²ƒ
    
    - ê°€ëŠ¥í•˜ë©´ `Global Trusted Libraries`ë¥¼ ì‚¬ìš©

    
    #### Global Trusted/Untrusted Libraries ë³„ íŠ¹ì§•

    | í•­ëª©               | **Trusted Pipeline Library**                            | **Untrusted Pipeline Library**                   |
    | ---------------- | ------------------------------------------------------- | ------------------------------------------------ |
    | ğŸ“¦ ìœ„ì¹˜            | Global ì„¤ì • or Folder-level ì„¤ì •<br>(`Manage Jenkins`ì—ì„œ ë“±ë¡) | `@Library('<lib-name>')` + SCM (ì˜ˆ: Git) ì—ì„œ ì§ì ‘ ë¡œë“œ |
    | ğŸ”’ Sandbox ì œì•½    | âŒ ì—†ìŒ (ì œí•œ ì—†ì´ ëª¨ë“  Groovy ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥)                         | âœ… Jenkins **sandbox ë‚´ì—ì„œ ì œí•œì ìœ¼ë¡œ ì‹¤í–‰**ë¨              |
    | ğŸ§ª ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥   | íŒŒì¼ ì½ê¸°, ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼, ì‹œìŠ¤í…œ API ì‚¬ìš© ë“± í—ˆìš©                         | ì œí•œì  (ë„¤íŠ¸ì›Œí¬, íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ë“± ê¸ˆì§€ë¨)                      |
    | ğŸ”§ Groovy í´ë˜ìŠ¤ ì •ì˜ | âœ… ììœ ë¡­ê²Œ ê°€ëŠ¥ (POJO, static method ë“±)                       | ğŸ”¶ ì œí•œ ìˆìŒ (íŠ¹ì • íŒ¨í„´ë§Œ í—ˆìš©)                             |
    | ğŸ“ Typical ì‚¬ìš©ì²˜   | ê¸°ì—… ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì•ˆì „í•œ ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬                               | ì™¸ë¶€ Contributor ë˜ëŠ” ì™¸ë¶€ ë¦¬í¬ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬                   |
    | â˜£ï¸ ë³´ì•ˆ ìœ„í—˜         | ë‚®ìŒ (ì‹ ë¢°ëœ ì½”ë“œë§Œ ì‚¬ìš©ë¨)                                        | ë†’ìŒ (ì½”ë“œê°€ ê²€ì¦ë˜ì§€ ì•ŠìŒ)                                 |


## Groovy ìŠ¤í¬ë¦½íŠ¸ ë‚´ ì‚¬ìš©ë°©ë²•

- Jenkinsfile ìµœìƒë‹¨ì— ë‹¤ìŒê³¼ ê°™ì´ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©

```groovy
// ê¸°ë³¸
@Library('ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë¦„') _

// ë²„ì „(ë¸Œëœì¹˜) ì§€ì • ì‹œ
@Library('ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë¦„@ë¸Œëœì¹˜ëª…') _
```

- í•¨ìˆ˜ ì‚¬ìš© ì˜ˆì‹œ

```groovy
pipeline {
    agent any
    stages {
        stage('Test') {
            steps {
                script {
                    exampleFunction() // vars/example.groovyì— ì •ì˜ëœ í•¨ìˆ˜
                }
            }
        }
    }
}
```